

#include "Beep.h"

uint16	x = 0;
uchar8	m = 0;

uint16 code md[212]=
{
	0,580,600,300,600,100,900,200,1200,350,900,170,1200,200,1500,170,1600,260,
	1500,260,1180,180,1350,350,0,360,600,250,600,100,900,170,1200,360,900,170,
	1200,180,1500,170,1600,260,1500,260,1200,170,1330,200,0,150,1500,240,
	1330,100,1200,350,1200,270,1330,80,1500,170,2000,180,2000,175,1800,
	170,1600,170,1500,180,1330,170,1600,180,1500,180,1200,170,900,350,
	1000,350,1000,250,1100,100,1200,180,1500,350,1200,180,1340,170,
	1500,180,1600,170,1670,170,1800,190,1340,150,900,150,750,200,600,
	300,600,100,900,200,1200,350,900,170,1200,200,1500,170,1600,260,
	1500,260,1180,180,1350,350,0,360,600,250,600,100,900,170,1200,360,900,
	170,1200,180,1500,170,1600,260,1500,260,1200,170,1330,200,0,150,1500,260,
	1330,90,1200,350,1200,260,1330,90,1500,170,2000,350,1800,170,1600,170,1500,
	180,1330,170,1600,170,1500,180,1200,170,900,350,1000,350,1000,260,1100,90,1200,170,
	1500,340,1200,180,1330,170,1200,170,1120,180,1330,170,1200,350,0,250
};

void Beep_Init()
{
	
}


void Beep_Update()
{
	if(x == 0)
	{
		x = md[m+1];
		
		Set_HZ( md[m] );
		
		m += 2;
		if(m>=212)
		{
			m = 0;
		}
	} 
	else 
	{
		x--;
	}
}


void Set_HZ(uint16 hz)
{
	if(0 < (int)(65536-FOSC/2/hz)) 
	{
		hz=65535;
	}
	AUXR |= 0x80;
	TMOD = 0x00;
	TMOD &= ~0x04;
	TL0 = (65536-FOSC/2/hz);
	TH0 = (65536-FOSC/2/hz) >> 8;
	INT_CLKO = 0x01;
	TR0 = 1;
}



